<div class="col-lg-12">
    <div class="main-box">    
        <header class="main-box-header clearfix">
            <h3>Registrar chofer</h3>
        </header>
        <div class="main-box-body clearfix">
            <div class="row">
                <div class="alert alert-info">
                    <ul>
                        <li>En este módulo podrás registrar los choferes del sistema.</li>
                        <li>Sí necesitas ayuda para usar este módulo haz clic en el botón <button class="btn btn-warning" type="button" onclick="javascript:introJs().start();"><i class="fa fa-question-circle"></i> AYUDA</button>.</li>
                    </ul>
                </div>
            </div>
            <form action="../controlador/control_chofer.php" method="POST" name="form_chofer" id="form_chofer" enctype="multipart/form-data">
                <input type="hidden" value="registrar_chofer" name="operacion" id="cam_operacion"/>
                <div class="row">
                    <div class="form-group col-sm-6 col-lg-3">
                        <label for="exampleTooltip">Cédula/Rif <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Cédula/Rif del chofer"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <div class="input-group">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><span id="inicial_rif">{inicial_rif}</span> <span class="caret"></span></button>
                                    <ul class="dropdown-menu" role="menu">
                                      <li class="rif_cho" data-value="V"><a href="#">V</a></li>
                                      <li class="rif_cho" data-value="E"><a href="#">E</a></li>
                                      <li class="rif_cho" data-value="J"><a href="#">J</a></li>
                                    </ul>
                                </div><!-- /btn-group -->
                                <input type="text" class="form-control" data-step="1" data-intro='Ingrese la Cédula/Rif del chofer a registrar' value="{inicial_rif}-" data-position="bottom" name="cedula_rifcho" id="cam_cedula_rifcho" value="" data-msg-minlength="Debe ingresar menos de {0} dígitos" data-msg-maxlength="Debe ingresar al menos {0} dígitos" data-rule-required="true" data-msg-required="Por favor ingrese la cédula/Rif del chofer" maxlength="10" minlength="8">
                            </div><!-- /input-group -->
                        </div>
                    </div>
                    <div class="form-group col-sm-6 col-lg-3">
                        <label for="exampleTooltip">Código <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Código del chofer"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <input type="text" class="form-control" data-step="2" data-intro='Ingrese el Código del chofer a registrar' data-position="bottom" name="idcodigocho" id="cam_idcodigocho" >
                        </div>
                    </div>
                    <div class="form-group col-sm-12 col-lg-6">
                        <label for="exampleTooltip">Alias <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Alias/apodo del chofer"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <input type="text" class="form-control" data-step="3" data-intro='Ingrese el alias/apodo del chofer a registrar' data-position="bottom" name="aliascho" id="cam_aliascho" >
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Nombre <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Nombre del chofer"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <input type="text" class="form-control" data-step="4" data-intro='Ingrese el nombre del chofer a registrar' data-position="bottom" name="nombrecho" id="cam_nombrecho" data-rule-required="true" data-msg-required="Por favor ingrese el nombre del chofer" data-rule-letras_latinas="true">
                        </div>
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Apellido <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Apellido del chofer"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <input type="text" class="form-control" data-step="5" data-intro='Ingrese el apellido del chofer a registrar' data-position="bottom" name="apellidocho" id="cam_apellidocho" data-rule-required="true" data-msg-required="Por favor ingrese el apellido del chofer" data-rule-letras_latinas="true">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Fecha de nacimiento <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Nombre del chofer"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                <input type="date" class="form-control" data-step="6" data-intro='Ingrese el nombre del chofer a registrar' data-position="bottom"  name="fechanacimientocho" id="cam_fechanacimientocho" data-rule-required="true" data-rule-date="true" data-msg-required="Por favor ingrese la fecha de nacimiento del chofer" >
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Dirección <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Dirección del chofer"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <textarea class="form-control" data-step="7" data-intro='Ingrese la dirección del chofer a registrar' data-position="bottom" name="direccioncho" id="cam_direccioncho" data-rule-required="true" data-msg-required="Por favor ingrese la dirección del chofer" data-rule-direccion="true" data-msg-minlength="Debe ingresar al menos {0} caracteres" data-msg-maxlength="Debe ingresar menos de{0} caracteres" maxlength="255" minlength="5" ></textarea>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Nº Teléfono movil <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Nº Teléfono del chofer"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-mobile-phone"></i></span>
                                <input type="text" class="form-control" data-step="8" data-intro='Ingrese el Nº Teléfono del chofer a registrar' data-position="bottom" name="telefonomovilcho" id="cam_telefonomovilcho" data-rule-required="true" data-msg-required="Por favor ingrese el teléfono movil del chofer" >
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Nº Teléfono Local <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Nº Teléfono Local del chofer"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-phone"></i></span>
                                <input type="text" class="form-control" data-step="9" data-intro='Ingrese el Nº Teléfono Local del chofer a registrar' data-position="bottom" name="telefonolocalcho" id="cam_telefonolocalcho" data-msg-minlength="Debe ingresar {0} caracteres" data-msg-maxlength="Debe ingresar {0} caracteres" maxlength="11" minlength="11">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Correo <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Correo del chofer"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="fa fa-envelope-o"></i></span>
                                <input type="email" class="form-control" data-step="10" data-intro='Ingrese el Correo del chofer a registrar' data-position="bottom" name="correocho" id="cam_correocho" data-msg-minlength="Debe ingresar al menos {0} caracteres" data-msg-maxlength="Debe ingresar menos de {0} caracteres" data-rule-valida_email="true" maxlength="55" minlength="10">
                            </div>
                        </div>
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Observación <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Observación del chofer"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <textarea class="form-control" data-step="11" data-intro='Puede ingresar una Observación del chofer a registrar' data-position="bottom" name="observacioncho" id="cam_observacioncho" data-rule-letras_latinas="true" ></textarea>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <h4><i class="fa fa-file-text-o"></i> Documentos</h4>

                    <table class="table table-hover col-lg-12">
                        <thead>
                            <th class="col-lg-3 col-sm-3 col-xs-3">Documento</th>
                            <th class="col-lg-2 col-sm-2 col-xs-2">Fecha Emisión</th>
                            <th class="col-lg-2 col-sm-2 col-xs-2">Fecha Vencimiento</th>
                            <th class="col-lg-4 col-sm-4 col-xs-4">Imagen</th>
                            <th class="col-lg-1 col-sm-1 col-xs-1"><button class="btn btn-success" type="button" data-step="14" data-intro='Agregar un documento' data-position="bottom" onclick="agregar_documento()"><i class="fa fa-plus"></i></button></th>
                        </thead>
                        <tbody id="filas">
                            <tr>
                                <td class="form-group col-lg-3 col-sm-3 col-xs-3">
                                    <div class="controls">
                                        <select class="form-control" onchange="validar_vence(this)" name="iddocumento[]" id="cam_iddocumento0" data-rule-required="true" data-msg-required="Por favor seleccione un documento" data-rule-validar_repetido="true">
                                            <option value=""></option>
                                            <!--LISTADO_DOCUMENTOS-->
                                                <option value="{iddocumento}" data-value="{vencedoc}">{descripciondoc}</option>
                                            <!--LISTADO_DOCUMENTOS-->
                                        </select>
                                    </div>
                                </td>
                                <td class="form-group col-lg-2 col-sm-2 col-xs-2">
                                    <div class="controls">
                                        <div class="input-group">
                                            <input type="date" class="form-control" name="fechaemisiondoc[]" id="cam_fechaemisiondoc0" data-rule-required="true" data-msg-required="Por favor ingrese la fecha de emisión del documento">
                                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </div>
                                </td>
                                <td class="form-group col-lg-2 col-sm-2 col-xs-2">
                                    <div class="controls">
                                        <div class="input-group" id="fechavencimientodoc0">
                                            <input type="date" class="form-control" name="fechavencimientodoc[]" id="cam_fechavencimientodoc0" data-rule-required="true" data-msg-required="Por favor ingrese la fecha de vencimiento del documento">
                                        <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </div>
                                    <p style="display:none" id="mensaje_fechavencimientodoc0">Este documento no vence.</p>
                                </td>
                                <td class="form-group col-lg-4 col-sm-4 col-xs-4">
                                    <div class="controls">
                                        <input type="file" class="form-control" name="directoriodoc[]" id="cam_directoriodoc0" data-rule-required="true" data-msg-required="Por favor ingrese la imagen del documento">
                                    </div>
                                </td>
                                <td class="col-lg-1 col-sm-1 col-xs-1">
                                    <button class="btn btn-danger" type="button" data-step="4" data-intro='Quitar un documento' data-position="bottom" onclick="quitar_documento(this)"><i class="fa fa-minus"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <input type="hidden" name="contador" id="cam_contador" value="0" />                    
                </div>
                <div class="row">
                    <div class="col-lg-offset-5 col-lg-10">
                        <button type="submit" data-step="12" data-intro='Para finalizar haga click en guardar para registrar el chofer.' data-position="top" class="btn btn-success" id="btn-enviar"><i class="fa fa-check"></i> Guardar</button>
                        <a href="?modulo=chofer/chofer" data-step="13" data-intro='Para salir haga click en regresar para registrar el chofer.' data-position="top" class="btn btn-danger "><i class="fa fa-chevron-left"></i> Regresar</a>
                    </div>
                </div>                
            </form>
        </div>
    </div>
</div>
<script>
$(document).ready(function(){
    $('#cam_fechanacimientocho').datepicker();
    $("#cam_telefonomovilcho").mask("9999 999-9999");
    $("#cam_telefonolocalcho").mask("9999 999-9999");
    $(".rif_cho").click(function(){
            var valor = $(this).attr("data-value");
            $("#inicial_rif").html(valor);

             numero=$("#cam_cedula_rifcho").val();
            if(numero.length>2)
                rif=numero.substring(2,numero.length);

            $("#cam_cedula_rifcho").val(valor+"-"+rif);
        });

     $.validator.addMethod(
          "letras_latinas",
          function(value, element) {
            return value.match(/^[0-9a-zA-ZáéíóúàèìòùÀÈÌÒÙÁÉÍÓÚñÑüÜ.\/*-+_\s]+$/);
          },
          "Por favor ingrese solo caracteres y números."
        );
        //Metodo validar Email
        $.validator.addMethod(
          "valida_email",
          function(value, element) {
            return value.match(/^[a-zA-Z0-9\._-]+@[a-zA-Z0-9-]{2,}[.][a-zA-Z]{2,4}$/);
          },
          "Por favor ingrese un correo electrónico valido."
        );
        $.validator.addMethod(
          "validar_repetido",
          function(value, element) {
            return validar_documento_repetido();
          },
          "Este documento ya ha sido seleccionado, por favor seleccione otro"
        );

        $("#form_chofer").validate({
            errorElement: 'label', //default input error message container
            errorClass: 'help-inline', // default input error message class
            focusInvalid: true,
            invalidHandler: function (event, validator) { //display error alert on form submit   
                $('.alert-danger').fadeIn('fast');
            },

            highlight: function (element) { // hightlight error inputs
                $(element)
                    .closest('.form-group').addClass('has-error'); // set error class to the control group
                $('#btn-enviar').attr('disabled',true);
            },

            success: function (label) {
                label.closest('.form-group').removeClass('has-error');
                label.remove();
                $('#btn-enviar').attr('disabled',false);
            },

            errorPlacement: function (error, element) {
                error.addClass('small no-left-padding').insertAfter(element.closest('.controls'));
            },

            submitHandler: function (form) {
                form.submit();
            }
        });

});
function validar_documento_repetido()
{
    iddocumento=document.getElementsByName('iddocumento[]');
    for(i=0;i<iddocumento.length;i++)
    {
        cont=0;
        for(j=0;j<iddocumento.length;j++)
        {
            if(iddocumento[i].value==iddocumento[j].value)
                cont++;
            if(cont==2)
                return false;
        }
    }

    return true;
}


function validar_vence(e)
{
    i=e.selectedIndex;
    vence=e.options[i].getAttribute('data-value');
    j=e.id.substring(e.id.length-1,e.id.length);
    if(vence=='1')
    {
        $("#fechavencimientodoc"+j).animate({ height: 'show', opacity: 'show' }, 'slow');
        $("#mensaje_fechavencimientodoc"+j).animate({ height: 'hide', opacity: 'hide' }, 'fast');

    }
    if(vence=='0')
    {
        $("#fechavencimientodoc"+j).animate({ height: 'hide', opacity: 'hide' }, 'fast');
        $("#mensaje_fechavencimientodoc"+j).animate({ height: 'show', opacity: 'show' }, 'slow');
        $("#cam_fechavencimientodoc"+j).val('');
    }

   

}

function agregar_documento()
{
    cam_contador=document.getElementById("cam_contador");
    contador=cam_contador.value;
    contador++;
      var url="../controlador/control_documento.php";

      var filas = document.getElementById('filas');
      var tr= document.createElement('tr');
      var col1= document.createElement('td');
      var select= document.createElement('select');
      var div= document.createElement('div');
      div.setAttribute('class','controls');
      select.setAttribute('class','form-control');
      select.setAttribute('name','iddocumento[]');
      select.setAttribute('id','cam_iddocumento'+contador);
      select.setAttribute('data-rule-required','true');
      select.setAttribute('data-rule-validar_repetido','true');
      select.setAttribute('data-msg-required','Por favor seleccione un documento');
      var col2= document.createElement('td');
      var col3= document.createElement('td');
      var col4= document.createElement('td');
      var col5= document.createElement('td');
      col1.setAttribute('class','form-group');
      col2.setAttribute('class','form-group');
      col3.setAttribute('class','form-group');
      col4.setAttribute('class','form-group');
      $.ajax({   
          type: "POST",
          url:url,
          data:{tipodoc:'Chofer',operacion:'consultar_documento'},
          success: function(datos){
              select.innerHTML=datos;   
           }
      });
                                    
      col2.innerHTML='<div class="controls"><div class="input-group"><input type="date" class="form-control" name="fechaemisiondoc[]" id="cam_fechaemisiondoc'+contador+'" data-rule-required="true" data-msg-required="Por favor ingrese la fecha de emisión del documento"><span class="input-group-addon"><i class="fa fa-calendar"></i></span></div></div>';
      col3.innerHTML='<div class="controls"><div class="input-group" id="'+contador+'"><input type="date" class="form-control" name="fechavencimientodoc[]" id="cam_fechaemisiondoc'+contador+'" data-rule-required="true" data-msg-required="Por favor ingrese la fecha de vencimiento del documento"><span class="input-group-addon"><i class="fa fa-calendar"></i></span></div><p style="display:none" id="mensaje_fechavencimientodoc'+contador+'">Este documento no vence.</p></div>';
      col4.innerHTML='<div class="controls"><input type="file" class="form-control" name="directoriodoc[]" id="cam_directoriodoc'+contador+'" data-rule-required="true" data-msg-required="Por favor ingrese la imagen del documento"></div>';
      col5.innerHTML='<button class="btn btn-danger" type="button" onclick="quitar_documento(this)"><i class="fa fa-minus"></i></button>';

      div.appendChild(select);
      col1.appendChild(div);
      tr.appendChild(col1);
      tr.appendChild(col2);
      tr.appendChild(col3);
      tr.appendChild(col4);
      tr.appendChild(col5);
      filas.appendChild(tr);
      cam_contador.value=contador;

}
function quitar_documento(e)
{

    var filas = document.getElementById("filas");          
    var td = e.parentNode;
    var tr = td.parentNode;
    filas.removeChild(tr);
}

</script>
