<div class="col-lg-12">
    <div class="main-box">    
        <header class="main-box-header clearfix">
            <h3>Consultar/Editar Producto</h3>
        </header>
        <div class="main-box-body clearfix">
            <div class="row">
                <div class="alert alert-info">
                    <ul>
                        <li>En este módulo podrás consultar y editar los productos del sistema.</li>
                        <li>Sí necesitas ayuda para usar este módulo haz clic en el botón <button class="btn btn-warning" type="button" onclick="javascript:introJs().start();"><i class="fa fa-question-circle"></i> AYUDA</button>.</li>
                    </ul>
                </div>
            </div>
            <form action="../controlador/control_producto.php" method="POST" name="form_producto" id="form_producto" enctype="multipart/form-data">
                <input type="hidden" value="editar_producto" name="operacion" id="cam_operacion"/>
                <input type="hidden" value="{idproducto}" name="idproducto" id="cam_idproducto"/>
                <div class="row">
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Código <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Código del producto"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <input type="text" class="form-control" data-step="1" data-intro='Ingrese el código del producto a registrar' data-position="bottom" name="idcodigo" value="{idcodigopro}" id="cam_nombreser" >
                        </div>
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Nombre corto <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Nombre corto del producto"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <input type="text" class="form-control" data-step="2" data-intro='Ingrese el nombre corto del producto a registrar' data-position="bottom" name="descripcioncortapro" value="{descripcioncortapro}" id="cam_descripcioncortapro" data-rule-required="true" data-msg-required="Por favor ingrese el nombre corto del producto" data-rule-letras_latinas="true">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Nombre largo <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Nombre largo del producto"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <input type="text" class="form-control" data-step="3" data-intro='Ingrese el nombre largo del producto a registrar' data-position="bottom" name="descripcionlargapro" value="{descripcionlargapro}" id="cam_descripcionlargapro"  data-rule-required="true" data-msg-required="Por favor ingrese el nombre largo del producto" data-rule-letras_latinas="true">
                        </div>
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Unidad de medida <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Unidad de medida del producto"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <select class="form-control" data-step="4" data-intro='Seleccione la unidad de medida del producto' data-position="bottom" name="unidadmedidapro" id="cam_unidadmedidapro" data-rule-required="true" data-msg-required="Por favor seleccione la unidad de medida del producto">
                                <option value=""></option>
                                <option value="lts" {selected_lts}>Litros</option>
                                <option value="kg" {selected_kg}>Kilos</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Precio Unitario<span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Precio del producto"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <input type="text" class="form-control" data-step="5" data-intro='Ingrese el Precio Unitario del producto a registrar' data-position="bottom" name="preciounitariopro" value="{preciounitariopro}" id="cam_preciounitariopro" data-rule-required="true" data-rule-number="true" data-msg-required="Por favor ingrese el precio del producto" data-msg-number="Por favor ingrese un precio válido">
                        </div>
                    </div>
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Precio Compra <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Precio de compra del producto"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <input type="text" class="form-control" data-step="5" data-intro='Ingrese el Precio de compra del producto a registrar' data-position="bottom" name="preciocomprapro" id="cam_preciocomprapro" value="{preciocomprapro}" data-rule-required="true" data-rule-number="true" data-msg-required="Por favor ingrese el precio de compra del producto" data-msg-number="Por favor ingrese un precio válido" >
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Existencia <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Existencia del producto"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <input type="text" class="form-control" data-step="6" data-intro='Ingrese la existencia del producto a registrar' data-position="bottom" name="existenciapro" value="{existenciapro}" id="cam_existenciapro" >
                        </div>
                    </div>
                </div>
                <div class="row">                             
                    <div class="form-group col-xs-6">
                        <div class="alert alert-danger" style="display:none" id="mensaje_error_registrar">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                        <i class="fa fa-times fa-fw fa-lg"></i>
                        <strong>Error </strong>al registrar un Tipo de producto
                        </div>
                        <div class="alert alert-success" style="display:none" id="mensaje_exito_registrar">
                            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                            <i class="fa fa-check fa-fw fa-lg"></i>
                            <strong>Éxito </strong>al registrar un Tipo de producto.
                        </div> 
                        <label for="exampleTooltip">Tipo Producto <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title=" tipo de producto al que pertenece el producto"><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <div class="input-group">
                                 <select class="form-control" data-step="7" data-intro='Seleccione el tipo de producto al que pertenece el producto a registrar' data-position="bottom" name="ttipo_producto_idtipo_producto" id="cam_ttipo_producto_idtipo_producto" data-rule-required="true" data-msg-required="Por favor seleccione el tipo de producto">
                                <option value=""></option>
                                    <!--LISTADO_TIPO_PRODUCTO-->
                                    <option value="{idtipo_producto}" {selected}>{descripciontip}</option>
                                    <!--LISTADO_TIPO_PRODUCTO-->
                                </select>
                                <span class="input-group-btn">
                                    <a class="btn btn-success bottom" data-toggle="modal" href="#myModalregistrarTipoProducto"  title="Permite registrar un tipo de producto"><i class="fa fa-plus"></i></a>                        
                                </span>
                            </div>                       
                        </div>                       
                    </div>
                     <div class="form-group col-xs-6">
                        <label for="exampleTooltip">Observación <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Observación sobre el producto."><i class="fa fa-question"></i></span></label>
                        <div class="controls">
                            <textarea name="observacionpro" data-step="8" data-intro='Observación sobre el producto a registrar' data-position="top" id="cam_observacionpro" cols="30" rows="3" class="form-control" data-rule-letras_latinas_2="true">{observacionpro}</textarea>
                        </div>
                    </div>
                </div>
                <div class="row table-responsive">
                    <h4><i class="fa fa-file-text-o"></i> Documentos</h4>

                    <table class="table table-hover col-lg-12">
                        <thead>
                            <th class="col-lg-3 col-sm-3 col-xs-3">Documento</th>
                            <th class="col-lg-2 col-sm-2 col-xs-2">Fecha Emisión</th>
                            <th class="col-lg-2 col-sm-2 col-xs-2">Fecha Vencimiento</th>
                            <th class="col-lg-1 col-sm-1 col-xs-1">Ver</th>
                            <th class="col-lg-3 col-sm-3 col-xs-3">Imagen</th>
                            <th class="col-lg-1 col-sm-1 col-xs-1"><button class="btn btn-success" type="button" data-step="14" data-intro='Agregar un documento' data-position="bottom" onclick="agregar_documento()"><i class="fa fa-plus"></i></button></th>
                        </thead>
                        <tbody id="filas">
                            <!--LISTADO_DOCUMENTOS_PRODUCTO-->
                            <tr>
                                <td class="form-group col-lg-3 col-sm-3 col-xs-3">
                                    <div class="controls">
                                        <select class="form-control" onchange="validar_vence(this)" name="iddocumento[]" id="cam_iddocumento0">
                                            <option value=""></option>
                                            <!--LISTADO_DOCUMENTOS{i}-->
                                                <option value="{iddocumento}" data-value="{vencedoc}" {selected}>{descripciondoc}</option>
                                            <!--LISTADO_DOCUMENTOS{i}-->
                                        </select>
                                    </div>
                                </td>
                                <td class="form-group col-lg-2 col-sm-2 col-xs-2">
                                    <div class="controls">
                                        <div class="input-group">
                                            <input type="date" class="form-control" name="fechaemisiondoc[]" value="{fechaemisiondoc}" id="cam_fechaemisiondoc0">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        </div>
                                    </div>
                                </td>
                                <td class="form-group col-lg-2 col-sm-2 col-xs-2">
                                    <div class="controls">
                                        <div class="input-group" id="fechavencimientodoc0">                                    
                                            <input type="date" class="form-control" value="{fechavencimientodoc}" name="fechavencimientodoc[]" id="cam_fechavencimientodoc0">
                                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                        </div>
                                        <p style="display:none" id="mensaje_fechavencimientodoc0">Este documento no vence.</p>
                                    </div>
                                </td>
                                <td class="form-group col-lg-1 col-sm-1 col-xs-1">
                                    <img class="img ver-imagen {imagen_hide}" data-toggle="modal" href="#myModalImagen"  data-titulo="{descripcionlargapro} - {descripciondoc}" src="../media/img/documentos_producto/{directoriodoc}">
                                    <a class="btn btn-success {descarga_hide}" href="../libreria/descargar_archivo.php?archivo={directoriodoc}" target="_blank"><i class="fa fa-download"></i></a>
                                </td>
                                <td class="form-group col-lg-3 col-sm-3 col-xs-3">
                                    <div class="controls">
                                        <input type="hidden" name="directorio_o[]" id="cam_directorio_o{i}" value="{directoriodoc}">
                                        <input type="file" class="form-control" name="directoriodoc[]" id="cam_directoriodoc{i}">
                                    </div>
                                </td>
                                <td class="col-lg-1 col-sm-1 col-xs-1">
                                    <button class="btn btn-danger" type="button" data-step="4" data-intro='Quitar un documento' data-position="bottom" onclick="quitar_documento(this)"><i class="fa fa-minus"></i></button>
                                </td>
                            </tr>
                            <!--LISTADO_DOCUMENTOS_PRODUCTO-->
                        </tbody>
                    </table>
                    <input type="hidden" name="contador" id="cam_contador" value="0" />                    
                </div>
                <div class="row">
                    <div class="col-lg-offset-2 col-lg-10">
                        <button type="submit" data-step="9" data-intro='Para finalizar haga click en guardar para registrar el producto.' data-position="top" class="btn btn-success" id="btn-enviar"><i class="fa fa-check"></i> Guardar</button>
                        <a href="?modulo=producto/producto" data-step="10" data-intro='Para salir haga click en regresar para registrar el producto.' data-position="top" class="btn btn-danger "><i class="fa fa-chevron-left"></i> Regresar</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="myModalregistrarTipoProducto" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Registrar Tipo Producto</h4>
            </div>
            <div class="modal-body">
                <form name="form_modal_registrar_tipo_producto" role="form">
                    <input type="hidden" name="operacion" id="cam_idoperacion" value="registrar_tipo_producto"/>
                    <div class="row">
                        <div class="alert alert-danger" style="display:none" id="mensaje_error_modal">
                            <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                            <i class="fa fa-times fa-fw fa-lg"></i>
                            <strong>Error </strong>Debe ingresar una descripción para el tipo de producto a registrar.
                        </div>
                        <div class="form-group col-xs-6">
                            <label for="exampleTooltip">Descripción<span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Descripción del tipo de producto"><i class="fa fa-question"></i></span></label>
                            <input type="text" class="form-control" name="descripciontip" id="cam_descripciontip" >
                        </div>
                        <div class="form-group col-xs-6">
                            <label for="exampleTooltip">Observación <span class="badge badge-warning" data-toggle="tooltip" data-placement="rigth" title="Observación del tipo deproducto"><i class="fa fa-question"></i></span></label>
                            <textarea class="form-control"  name="observaciontip" id="cam_observaciontip"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" data-dismiss="modal" onclick="registrar_tipo_producto()"><i class="fa fa-check"></i> Registrar</button>

                        <button type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i>Cancelar</button>
                    </div>
                </form>
            </div>
        </div> 
    </div> 
</div>
<script type="text/javascript">
$(document).ready(function(){
        $.validator.addMethod(
          "letras_latinas",
          function(value, element) {
                return value.match(/^[0-9a-zA-ZáéíóúàèìòùÀÈÌÒÙÁÉÍÓÚñÑüÜ.\/*-+_\s]+$/);

          },
          "Por favor ingrese solo caracteres y números."
        );
         $.validator.addMethod(
          "letras_latinas_2",
          function(value, element) {
            if(value!='')
                return value.match(/^[0-9a-zA-ZáéíóúàèìòùÀÈÌÒÙÁÉÍÓÚñÑüÜ.\/*-+_\s]+$/);
            else
                return true;
          },
          "Por favor ingrese solo caracteres y números."
        );
        //Metodo validar Email
        $.validator.addMethod(
          "valida_email",
          function(value, element) {
            return value.match(/^[a-zA-Z0-9\._-]+@[a-zA-Z0-9-]{2,}[.][a-zA-Z]{2,4}$/);
          },
          "Por favor ingrese un correo electrónico valido."
        );
        $.validator.addMethod(
          "validar_repetido",
          function(value, element) {
            return validar_documento_repetido();
          },
          "Este documento ya ha sido seleccionado, por favor seleccione otro"
        );

        $("#form_producto").validate({
            errorElement: 'label', //default input error message container
            errorClass: 'help-inline', // default input error message class
            focusInvalid: true,
            invalidHandler: function (event, validator) { //display error alert on form submit   
                $('.alert-danger').fadeIn('fast');
            },

            highlight: function (element) { // hightlight error inputs
                $(element)
                    .closest('.form-group').addClass('has-error'); // set error class to the control group
                $('#btn-enviar').attr('disabled',true);
            },

            success: function (label) {
                label.closest('.form-group').removeClass('has-error');
                label.remove();
                $('#btn-enviar').attr('disabled',false);
            },

            errorPlacement: function (error, element) {
                error.addClass('small no-left-padding').insertAfter(element.closest('.controls'));
            },

            submitHandler: function (form) {
                form.submit();
            }
        });
    });
      function registrar_tipo_producto(){
        descripcion=document.getElementById('cam_descripciontip').value;
        observacion=document.getElementById('cam_observaciontip').value;
        if(descripcion)
        {
          var url="../controlador/control_tipo_producto.php";
          $.ajax({   
              type: "POST",
              url:url,
              data:{descripciontip:descripcion,observaciontip:observacion,operacion:'registrar_tipo_producto_ajax'},
              success: function(datos){
                 if(datos=='1')
                 {
                    $("#mensaje_exito_registrar").animate({ height: 'show', opacity: 'show' }, 'slow');
                     consultar_tipo_producto();
                     setTimeout(function() {
                        $("#mensaje_exito_registrar").animate({ height: 'hide', opacity: 'hide' }, 'slow');
                    }, 3500); 
                    
                 } 
                 else
                 {
                     $("#mensaje_error_registrar").animate({ height: 'show', opacity: 'show' }, 'slow');
                     setTimeout(function() {
                        $("#mensaje_error_registrar").animate({ height: 'hide', opacity: 'hide' }, 'slow');
                    }, 3500); 
                 } 
               }
          });
        }
        else
        {
            $("#mensaje_error_modal").animate({ height: 'show', opacity: 'show' }, 'slow');

            setTimeout(function() {
                $("#mensaje_error_modal").animate({ height: 'hide', opacity: 'hide' }, 'slow');
            }, 3500); 

        }
  }

  function consultar_tipo_producto()
  {

          var url="../controlador/control_tipo_producto.php";
          $.ajax({   
              type: "POST",
              url:url,
              data:{operacion:'consultar_tipo_producto'},
              success: function(datos){
                  $('#cam_ttipo_producto_idtipo_producto').html(datos);   
               }
          });
  }

  function validar_vence(e)
{
    i=e.selectedIndex;
    vence=e.options[i].getAttribute('data-value');
    j=e.id.substring(e.id.length-1,e.id.length);
    if(vence=='1')
    {
        $("#fechavencimientodoc"+j).animate({ height: 'show', opacity: 'show' }, 'slow');
        $("#mensaje_fechavencimientodoc"+j).animate({ height: 'hide', opacity: 'hide' }, 'fast');

    }
    if(vence=='0')
    {
        $("#fechavencimientodoc"+j).animate({ height: 'hide', opacity: 'hide' }, 'fast');
        $("#mensaje_fechavencimientodoc"+j).animate({ height: 'show', opacity: 'show' }, 'slow');
        $("#cam_fechavencimientodoc"+j).val('');
    }

   

}

function agregar_documento()
{
    cam_contador=document.getElementById("cam_contador");
    contador=cam_contador.value;
    contador++;
      var url="../controlador/control_documento.php";

      var filas = document.getElementById('filas');
      var tr= document.createElement('tr');
      var col1= document.createElement('td');
      var select= document.createElement('select');
      var div= document.createElement('div');
      div.setAttribute('class','controls');
      select.setAttribute('class','form-control');
      select.setAttribute('name','iddocumento[]');
      select.setAttribute('id','cam_iddocumento'+contador);
      select.setAttribute('data-rule-required','true');
      select.setAttribute('data-rule-validar_repetido','true');
      select.setAttribute('data-msg-required','Por favor seleccione un documento');

      var col2= document.createElement('td');
      var col3= document.createElement('td');
      var col4= document.createElement('td');
      var col5= document.createElement('td');
      col1.setAttribute('class','form-group');
      col2.setAttribute('class','form-group');
      col3.setAttribute('class','form-group');
      col4.setAttribute('class','form-group');

      $.ajax({   
          type: "POST",
          url:url,
          data:{tipodoc:'Producto',operacion:'consultar_documento'},
          success: function(datos){
              select.innerHTML=datos;   
           }
      });
      col2.innerHTML='<div class="controls"><div class="input-group"><input type="date" class="form-control" name="fechaemisiondoc[]" id="cam_fechaemisiondoc'+contador+'"><span class="input-group-addon"><i class="fa fa-calendar"></i></span></div></div>';
      col3.innerHTML='<div class="controls"><div class="input-group" id="'+contador+'"><input type="date" class="form-control" name="fechavencimientodoc[]" id="cam_fechaemisiondoc'+contador+'"><span class="input-group-addon"><i class="fa fa-calendar"></i></span></div><p style="display:none" id="mensaje_fechavencimientodoc'+contador+'">Este documento no vence.</p></div>';
      col4.innerHTML='';
      col5.innerHTML='<div class="controls"><input type="file" class="form-control directoriodoc" name="directoriodoc[]" id="cam_directoriodoc'+contador+'"></div>';
      col6.innerHTML='<button class="btn btn-danger" type="button" onclick="quitar_documento(this)"><i class="fa fa-minus"></i></button>';

      div.appendChild(select);
      col1.appendChild(div);
      tr.appendChild(col1);
      tr.appendChild(col2);
      tr.appendChild(col3);
      tr.appendChild(col4);
      tr.appendChild(col5);
      tr.appendChild(col6);
      filas.appendChild(tr);
      cam_contador.value=contador;

}
function quitar_documento(e)
{
    var filas = document.getElementById("filas");          
    var td = e.parentNode;
    var tr = td.parentNode;
    filas.removeChild(tr);
}

</script>